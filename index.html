<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORA Terminal Shell</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #0a0a0a;
            color: #f0f0f0;
            font-family: 'Courier New', 'Cascadia Code', monospace;
            height: 100vh;
            overflow: hidden;
            position: relative;
            user-select: none;
        }
        
        /* Matrix Canvas Background */
        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.08;
        }
        
        /* Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(20, 20, 20, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        
        .control-title {
            color: #4af626;
            margin-bottom: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        .panel-btn {
            background: #333;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            width: 100%;
            margin-top: 5px;
            transition: all 0.3s;
        }
        
        .panel-btn:hover {
            background: #444;
        }
        
        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* Terminal Container - Draggable & Resizable */
        .terminal-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 500px;
            background-color: rgba(0, 0, 0, 0.95);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            z-index: 10;
            min-width: 400px;
            min-height: 300px;
            resize: both;
            overflow: hidden;
        }
        
        /* Terminal Header - Draggable area */
        .terminal-header {
            background: linear-gradient(to bottom, #1a1a1a, #000);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            cursor: move;
            user-select: none;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .terminal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .terminal-button {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .terminal-button:hover {
            transform: scale(1.1);
        }
        
        .close { background-color: #ff5f56; }
        .minimize { background-color: #ffbd2e; }
        .maximize { background-color: #27ca3f; }
        
        .terminal-title {
            color: #888;
            font-size: 14px;
            flex-grow: 1;
            text-align: center;
            margin: 0 20px;
        }
        
        /* Terminal Body */
        .terminal-body {
            height: calc(100% - 45px);
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.9);
        }
        
        .output {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 8px;
            line-height: 1.4;
            font-size: 14px;
        }
        
        .prompt {
            color: #4af626;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .input-line {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .command-input {
            background: transparent;
            border: none;
            color: #f0f0f0;
            font-family: inherit;
            font-size: 14px;
            width: 100%;
            outline: none;
            caret-color: #4af626;
            flex: 1;
        }
        
        /* Text Colors */
        .command { color: #4af626; }
        .error { color: #ff5555; }
        .success { color: #50fa7b; }
        .info { color: #8be9fd; }
        .system { color: #bd93f9; }
        .warning { color: #ffb86c; }
        .matrix { color: #00ff9d; }
        .hacker { color: #00ff00; }
        .file { color: #ffaa00; }
        
        /* Cursor */
        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #4af626;
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Scrollbar */
        .terminal-body::-webkit-scrollbar {
            width: 10px;
        }
        
        .terminal-body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .terminal-body::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        .terminal-body::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Resize Handle */
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
            z-index: 20;
        }
        
        .resize-handle::after {
            content: '';
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 10px;
            height: 10px;
            border-right: 2px solid #444;
            border-bottom: 2px solid #444;
        }
        
        /* Boot Screen */
        .boot-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            color: #00ff00;
            padding: 20px;
        }
        
        .boot-line {
            white-space: pre;
            font-size: 12px;
            line-height: 1.2;
            padding: 2px 0;
            animation: flicker 0.3s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        /* File List */
        .file-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-item:hover {
            background: rgba(0, 255, 0, 0.05);
        }
        
        .file-icon {
            width: 20px;
            text-align: center;
        }
        
        .file-size {
            margin-left: auto;
            color: #888;
            font-size: 12px;
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #444;
            border-top-color: #00ff00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .terminal-container {
                width: 95vw !important;
                height: 80vh !important;
                position: fixed !important;
                top: 10vh !important;
                left: 2.5vw !important;
                transform: none !important;
                min-width: 300px !important;
                min-height: 400px !important;
                resize: none;
            }
            
            .control-panel {
                top: 10px;
                right: 10px;
                padding: 10px;
                max-width: 200px;
            }
            
            .terminal-header {
                padding: 10px 15px;
            }
            
            .terminal-body {
                padding: 15px;
            }
        }
        
        /* Terminal Startup Animation */
        @keyframes terminalStart {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .terminal-start-animation {
            animation: terminalStart 0.5s ease-out;
        }
        
        /* File Preview */
        .code-preview {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .line-number {
            color: #666;
            margin-right: 10px;
            user-select: none;
        }
    </style>
</head>
<body>
    <!-- Matrix Canvas Background -->
    <canvas id="matrix-canvas"></canvas>
    
    <!-- Control Panel -->
    <div class="control-panel">
        <div class="control-title">ORA TERMINAL CONTROL</div>
        <div id="file-preview" class="file-preview">
            <span class="system">File System Ready</span><br>
            <span class="info">Ready to launch ORA Tool</span>
        </div>
        <button class="panel-btn" id="hide-panel">Hide Panel</button>
        <button class="panel-btn" id="reset-terminal">Reset Terminal</button>
    </div>
    
    <!-- Terminal Window -->
    <div class="terminal-container terminal-start-animation">
        <div class="terminal-header" id="terminal-header">
            <div class="header-left">
                <div class="terminal-buttons">
                    <div class="terminal-button close" id="close-btn"></div>
                    <div class="terminal-button minimize" id="minimize-btn"></div>
                    <div class="terminal-button maximize" id="maximize-btn"></div>
                </div>
                <div class="terminal-title">ora terminal shell</div>
            </div>
        </div>
        
        <div class="terminal-body" id="terminal-output">
            <div class="output">
                <span class="system">system 0.1 is running</span><br>
                <span class="system">> ora terminal shell</span><br>
                <span class="system">> made by Bertrand</span><br>
                <span class="system">> 2025</span><br><br>
                <span class="info">Type 'help' to see functions</span><br>
                <span class="info">Type 'orastart' to launch ORA Tool</span><br>
                <span class="info">Type 'color 1-12' to change matrix color</span><br><br>
            </div>
        </div>
        
        <div class="resize-handle"></div>
    </div>

    <script>
        // ==============================
        // MATRIX ANIMATION
        // ==============================
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        let matrixColor = '#00ff9d';
        
        // Color definitions for 12 colors
        const matrixColors = [
            '#00ff9d', // 1 - Matrix Green
            '#4af626', // 2 - Neon Green
            '#00ffff', // 3 - Cyan
            '#ff00ff', // 4 - Magenta
            '#ffaa00', // 5 - Orange
            '#ff5555', // 6 - Red
            '#ffffff', // 7 - White
            '#9d00ff', // 8 - Purple
            '#00aaff', // 9 - Blue
            '#ffff00', // 10 - Yellow
            '#ff6b8b', // 11 - Pink
            '#00ff00'  // 12 - Pure Green
        ];
        
        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        // Matrix characters
        const chars = "01„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë„Ç§„Ç£„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„É∞„ÇÆ„Ç∏„ÉÇ„Éì„Éî„Ç¶„Ç•„ÇØ„Çπ„ÉÑ„Éå„Éï„É†„É¶„É•„É´„Ç∞„Ç∫„Éñ„ÉÖ„Éó„Ç®„Çß„Ç±„Çª„ÉÜ„Éç„Éò„É°„É¨„É±„Ç≤„Çº„Éá„Éô„Éö„Ç™„Ç©„Ç≥„ÇΩ„Éà„Éé„Éõ„É¢„É®„Éß„É≠„É≤„Ç¥„Çæ„Éâ„Éú„Éù„É¥„ÉÉ„É≥";
        const charArray = chars.split("");
        const fontSize = 14;
        let columns = 0;
        let drops = [];
        
        // Initialize matrix
        function initMatrix() {
            resizeCanvas();
            columns = Math.floor(canvas.width / fontSize);
            drops = [];
            for(let i = 0; i < columns; i++) {
                drops[i] = Math.floor(Math.random() * canvas.height / fontSize);
            }
        }
        
        // Draw matrix
        function drawMatrix() {
            // Semi-transparent black rectangle for trail effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Set text style
            ctx.font = `${fontSize}px 'Courier New', monospace`;
            
            // Draw characters
            for(let i = 0; i < drops.length; i++) {
                // Random character
                const char = charArray[Math.floor(Math.random() * charArray.length)];
                
                // Gradient color effect
                const opacity = Math.random() * 0.5 + 0.5;
                ctx.fillStyle = matrixColor.replace(')', `, ${opacity})`).replace('rgb', 'rgba');
                
                // Draw character
                ctx.fillText(char, i * fontSize, drops[i] * fontSize);
                
                // Move drop down
                drops[i]++;
                
                // Randomly reset drop
                if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
            }
        }
        
        // ==============================
        // FILE SYSTEM SCANNER (SIMULATED)
        // ==============================
        class FileSystemScanner {
            constructor() {
                this.files = [];
                this.filesPath = './files/'; // Changed from '/files/'
                this.fileTypes = {
                    '.html': 'üåê', '.htm': 'üåê',
                    '.js': 'üìú', '.json': 'üìÑ',
                    '.css': 'üé®', '.scss': 'üé®', '.sass': 'üé®',
                    '.py': 'üêç', '.java': '‚òï', '.cpp': '‚öôÔ∏è', '.c': '‚öôÔ∏è',
                    '.md': 'üìù', '.txt': 'üìù',
                    '.jpg': 'üñºÔ∏è', '.jpeg': 'üñºÔ∏è', '.png': 'üñºÔ∏è', '.gif': 'üñºÔ∏è',
                    '.pdf': 'üìï', '.doc': 'üìò', '.docx': 'üìò',
                    '.zip': 'üì¶', '.rar': 'üì¶', '.tar': 'üì¶',
                    '.mp3': 'üéµ', '.wav': 'üéµ',
                    '.mp4': 'üé¨', '.avi': 'üé¨'
                };
                
                // Default demo files for when real files aren't available
                this.defaultFiles = [
                    { name: 'index.html', path: './files/index.html', isDirectory: false, icon: 'üåê', size: '2.4 KB', lastModified: 'Today', content: this.getDefaultContent('index.html') },
                    { name: 'style.css', path: './files/style.css', isDirectory: false, icon: 'üé®', size: '1.8 KB', lastModified: 'Today', content: this.getDefaultContent('style.css') },
                    { name: 'script.js', path: './files/script.js', isDirectory: false, icon: 'üìú', size: '3.1 KB', lastModified: 'Today', content: this.getDefaultContent('script.js') },
                    { name: 'readme.md', path: './files/readme.md', isDirectory: false, icon: 'üìù', size: '0.8 KB', lastModified: 'Today', content: this.getDefaultContent('readme.md') },
                    { name: 'config.json', path: './files/config.json', isDirectory: false, icon: 'üìÑ', size: '0.5 KB', lastModified: 'Today', content: this.getDefaultContent('config.json') },
                    { name: 'images/', path: './files/images/', isDirectory: true, icon: 'üìÅ', size: '--', lastModified: 'Today', content: 'Directory containing image files' },
                    { name: 'documents/', path: './files/documents/', isDirectory: true, icon: 'üìÅ', size: '--', lastModified: 'Today', content: 'Directory containing document files' },
                    { name: 'ora-tool.md', path: './files/ora-tool.md', isDirectory: false, icon: 'üìù', size: '1.2 KB', lastModified: 'Today', content: this.getDefaultContent('ora-tool.md') }
                ];
            }
            
            getDefaultContent(filename) {
                const contents = {
                    'index.html': `<!DOCTYPE html>
<html>
<head>
    <title>ORA Terminal Project</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>ORA Terminal Project</h1>
    <p>This is a demo HTML file for the ORA Terminal project.</p>
</body>
</html>`,
                    'style.css': `/* ORA Terminal Styles */
body {
    font-family: 'Courier New', monospace;
    background: #0a0a0a;
    color: #00ff00;
}

.terminal {
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid #00ff00;
    border-radius: 5px;
    padding: 20px;
}`,
                    'script.js': `// ORA Terminal JavaScript
class ORATerminal {
    constructor() {
        this.version = '0.1.0';
        this.mode = 'normal';
    }
    
    start() {
        console.log('ORA Terminal starting...');
    }
    
    execute(command) {
        return \`Executing: \${command}\`;
    }
}

const terminal = new ORATerminal();
terminal.start();`,
                    'readme.md': `# ORA Terminal

## Overview
Advanced web-based terminal with Matrix effects and file management.

## Features
- Matrix animation background
- Draggable/resizable terminal
- ORA Tool system with authentication
- File operations (view, download, print)
- 12 different matrix colors

## Usage
Type 'orastart' to launch ORA Tool system.`,
                    'config.json': `{
    "app": "ORA Terminal",
    "version": "0.1.0",
    "author": "Bertrand",
    "year": 2025,
    "features": [
        "Matrix animation",
        "Draggable terminal",
        "ORA Tool system",
        "File operations"
    ]
}`,
                    'ora-tool.md': `# ORA Tool Documentation

## Authentication
Username: bertrand
Password: karekezi@2

## File Operations
- ls: List files
- cd: Open file
- open: Open in new tab
- download: Download file
- view: View content
- exit: Exit file mode

## Security
All authentication is handled locally in the browser.`
                };
                
                return contents[filename] || `Content of ${filename}`;
            }
            
            getFileIcon(filename) {
                const extension = filename.substring(filename.lastIndexOf('.')).toLowerCase();
                return this.fileTypes[extension] || 'üìÑ';
            }
            
            async scanFiles() {
                try {
                    // Try to fetch from relative path first
                    const response = await fetch(this.filesPath, {
                        method: 'HEAD',
                        mode: 'no-cors'
                    }).catch(() => null);
                    
                    // If we can't access the directory, use demo files
                    console.log('Using demo file system (real files not accessible on this server)');
                    this.files = this.defaultFiles;
                    this.updateFilePreview();
                    return this.files;
                    
                } catch (error) {
                    console.log('Using demo file system:', error.message);
                    this.files = this.defaultFiles;
                    this.updateFilePreview();
                    return this.files;
                }
            }
            
            updateFilePreview() {
                const preview = document.getElementById('file-preview');
                if (!preview) return;
                
                preview.innerHTML = `<span class="system">Demo Files: ${this.files.length}</span><br>
                <span class="info">(Real files not accessible)</span><br>`;
                
                this.files.slice(0, 4).forEach(file => {
                    preview.innerHTML += `<span class="file">${file.icon} ${file.name}</span><br>`;
                });
                
                if (this.files.length > 4) {
                    preview.innerHTML += `<span class="info">...and ${this.files.length - 4} more</span>`;
                }
            }
            
            async getFileContent(filename) {
                try {
                    const file = this.files.find(f => f.name === filename);
                    if (!file) {
                        throw new Error('File not found');
                    }
                    
                    // For demo files, return stored content
                    if (file.content) {
                        return file.content;
                    }
                    
                    // Try to fetch real file
                    const response = await fetch(file.path);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch ${filename}`);
                    }
                    
                    return await response.text();
                } catch (error) {
                    console.log('Using demo content for:', filename);
                    const file = this.files.find(f => f.name === filename);
                    return file?.content || `Demo content for ${filename}\n\nThis file is part of the ORA Terminal demo system.\nReal file access is not available on this server configuration.`;
                }
            }
            
            async downloadFile(filename) {
                try {
                    const file = this.files.find(f => f.name === filename);
                    if (!file) {
                        throw new Error('File not found');
                    }
                    
                    // Create a blob with the file content for download
                    const content = await this.getFileContent(filename);
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    return true;
                } catch (error) {
                    console.error('Error downloading file:', error);
                    return false;
                }
            }
        }
        
        // ==============================
        // ORA TOOL SYSTEM
        // ==============================
        class ORATool {
            constructor() {
                this.mode = 'normal'; // normal, boot, login, ora-tool, file-mode
                this.currentPath = '/';
                this.currentFile = null;
                this.loggedIn = false;
                this.username = 'bertrand';
                this.password = 'karekezi@2';
                this.fileScanner = new FileSystemScanner();
                this.isBooting = false; // Add flag to prevent multiple boot sequences
            }
            
            // ==============================
            // BOOT SEQUENCE (FIXED)
            // ==============================
            async startBootSequence() {
                // Prevent multiple boot sequences
                if (this.isBooting) {
                    return;
                }
                
                this.isBooting = true;
                this.mode = 'boot';
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                const bootMessages = [
                    "[BOOT] Starting ORA Secure Boot Sequence...",
                    "[OK] Memory test passed",
                    "[OK] CPU: 8 cores detected",
                    "[OK] RAM: 16GB available",
                    "[LOAD] Loading kernel modules...",
                    "   -> module_security.ko [LOADED]",
                    "   -> module_encryption.ko [LOADED]",
                    "   -> module_network.ko [LOADED]",
                    "   -> module_filesystem.ko [LOADED]",
                    "[OK] All modules loaded",
                    "[CRYPTO] Initializing encryption...",
                    "   Generating RSA-4096 keys...",
                    "   Setting up AES-256...",
                    "[OK] Encryption ready",
                    "[NET] Configuring network...",
                    "   Establishing secure connection...",
                    "   Handshake complete",
                    "[OK] Network: ONLINE",
                    "[AUTH] Starting authentication service...",
                    "[SCAN] Running system integrity check...",
                    "   Checking file permissions...",
                    "   Verifying signatures...",
                    "   Scanning for vulnerabilities...",
                    "[OK] System integrity: 100%",
                    "[SECURE] Entering secure mode...",
                    "[DECRYPT] Loading secure environment...",
                    "   Accessing encrypted partition...",
                    "   Decrypting session keys...",
                    "[OK] Secure environment ready",
                    "[INIT] Starting ORA Tool Environment...",
                    "   Loading user profiles...",
                    "   Mounting virtual filesystem...",
                    "   Initializing UI components...",
                    "[OK] Environment initialized",
                    "[SCAN] Scanning file system...",
                    "[WAIT] Finalizing boot process..."
                ];
                
                // Show boot messages
                for (let i = 0; i < bootMessages.length; i++) {
                    const line = document.createElement('div');
                    line.className = 'output hacker';
                    line.textContent = bootMessages[i];
                    
                    // Random flicker effect
                    if (Math.random() > 0.7) {
                        line.style.opacity = '0.5';
                        setTimeout(() => {
                            line.style.opacity = '1';
                        }, 50);
                    }
                    
                    output.appendChild(line);
                    output.scrollTop = output.scrollHeight;
                    
                    // Wait between messages
                    await new Promise(resolve => setTimeout(resolve, 80));
                }
                
                // Final message
                await new Promise(resolve => setTimeout(resolve, 500));
                const finalMsg = document.createElement('div');
                finalMsg.className = 'output success';
                finalMsg.textContent = "[OK] Initialization complete.";
                output.appendChild(finalMsg);
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                this.mode = 'login';
                this.isBooting = false;
                this.showLoginPrompt();
            }
            
            // ==============================
            // LOGIN SYSTEM
            // ==============================
            showLoginPrompt() {
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                const loginDiv = document.createElement('div');
                loginDiv.className = 'output';
                loginDiv.innerHTML = '<span class="hacker">Username:</span>';
                output.appendChild(loginDiv);
                
                this.createLoginInput('username');
            }
            
            createLoginInput(field) {
                const output = document.getElementById('terminal-output');
                const inputLine = document.createElement('div');
                inputLine.className = 'input-line';
                
                const prompt = field === 'username' ? 'Username:' : 'Password:';
                
                inputLine.innerHTML = `
                    <span class="prompt">${prompt}</span>
                    <input type="${field === 'password' ? 'password' : 'text'}" 
                           class="command-input login-field"
                           autocomplete="off" 
                           autofocus
                           ${field === 'password' ? 'style="color: transparent; text-shadow: 0 0 0 #00ff00;"' : ''}>
                    <span class="cursor"></span>
                `;
                
                output.appendChild(inputLine);
                
                const input = inputLine.querySelector('.command-input');
                input.focus();
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const value = input.value.trim();
                        inputLine.remove();
                        this.processLoginInput(field, value);
                    }
                });
                
                output.scrollTop = output.scrollHeight;
            }
            
            processLoginInput(field, value) {
                const output = document.getElementById('terminal-output');
                
                if (field === 'username') {
                    if (value.toLowerCase() === this.username) {
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'output';
                        resultDiv.innerHTML = `<span class="success">Username verified</span>`;
                        output.appendChild(resultDiv);
                        
                        setTimeout(() => {
                            const promptDiv = document.createElement('div');
                            promptDiv.className = 'output';
                            promptDiv.innerHTML = `<span class="hacker">Password:</span>`;
                            output.appendChild(promptDiv);
                            this.createLoginInput('password');
                        }, 500);
                    } else {
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'output';
                        resultDiv.innerHTML = `<span class="error">Invalid username. Try again.</span>`;
                        output.appendChild(resultDiv);
                        
                        setTimeout(() => {
                            const promptDiv = document.createElement('div');
                            promptDiv.className = 'output';
                            promptDiv.innerHTML = `<span class="hacker">Username:</span>`;
                            output.appendChild(promptDiv);
                            this.createLoginInput('username');
                        }, 1000);
                    }
                } else if (field === 'password') {
                    if (value === this.password) {
                        this.loggedIn = true;
                        
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'output';
                        resultDiv.innerHTML = `
                            <span class="success">Login successful.</span><br>
                            <span class="hacker">Welcome to ORA Tool Environment.</span>
                        `;
                        output.appendChild(resultDiv);
                        
                        setTimeout(() => {
                            this.enterORATool();
                        }, 1500);
                    } else {
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'output';
                        resultDiv.innerHTML = `<span class="error">Incorrect password.</span>`;
                        output.appendChild(resultDiv);
                        
                        setTimeout(() => {
                            const promptDiv = document.createElement('div');
                            promptDiv.className = 'output';
                            promptDiv.innerHTML = `<span class="hacker">Password:</span>`;
                            output.appendChild(promptDiv);
                            this.createLoginInput('password');
                        }, 1000);
                    }
                }
                
                output.scrollTop = output.scrollHeight;
            }
            
            // ==============================
            // ORA TOOL ENVIRONMENT
            // ==============================
            async enterORATool() {
                this.mode = 'ora-tool';
                this.currentPath = '/files';
                this.currentFile = null;
                
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                // Scan for files
                const files = await this.fileScanner.scanFiles();
                
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'output';
                welcomeDiv.innerHTML = `
                    <span class="hacker">Entering ORA Tool...</span><br>
                    <span class="hacker">Initializing File Workspace...</span><br>
                    <span class="success">Active Repository: ${this.currentPath}</span><br>
                    <span class="success">Found ${files.length} files</span><br><br>
                    <span class="info">Type "ls" to view available files.</span><br>
                    <span class="info">Type "cd filename" to open a file.</span><br>
                    <span class="info">Type "exit" to quit ORA Tool.</span>
                `;
                output.appendChild(welcomeDiv);
                
                createInputLine();
            }
            
            // ==============================
            // FILE LISTING
            // ==============================
            async listFiles() {
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                const files = await this.fileScanner.scanFiles();
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'output';
                headerDiv.innerHTML = `<span class="info">Repository: ${this.currentPath}</span><br>`;
                output.appendChild(headerDiv);
                
                if (files.length === 0) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.className = 'output error';
                    emptyDiv.textContent = 'No files found';
                    output.appendChild(emptyDiv);
                } else {
                    files.forEach(file => {
                        const fileDiv = document.createElement('div');
                        fileDiv.className = 'output file-item';
                        fileDiv.innerHTML = `
                            <span class="file-icon">${file.icon}</span>
                            <span class="${file.isDirectory ? 'info' : 'system'}">${file.name}</span>
                            <span class="file-size">${file.size}</span>
                        `;
                        output.appendChild(fileDiv);
                    });
                }
                
                const helpDiv = document.createElement('div');
                helpDiv.className = 'output';
                helpDiv.innerHTML = `<br><span class="system">Type "cd filename" to open a file, or "exit" to quit ORA Tool.</span>`;
                output.appendChild(helpDiv);
                
                createInputLine();
            }
            
            // ==============================
            // FILE MODE
            // ==============================
            async enterFileMode(fileName) {
                this.mode = 'file-mode';
                this.currentFile = fileName;
                
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                // Get file info
                const files = await this.fileScanner.scanFiles();
                const file = files.find(f => f.name === fileName);
                
                if (!file) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'output error';
                    errorDiv.textContent = `File not found: ${fileName}`;
                    output.appendChild(errorDiv);
                    createInputLine();
                    return;
                }
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'file-mode-header';
                headerDiv.innerHTML = `
                    <span class="hacker">=== FILE MODE: ${fileName} ===</span><br>
                    <span class="system">Path: ${file.path}</span><br>
                    <span class="system">Size: ${file.size}</span><br>
                    <span class="system">Type: ${file.isDirectory ? 'DIRECTORY' : 'FILE'}</span><br><br>
                    <span class="info">Available commands:</span><br>
                    <span class="command">open</span> - Open file in new tab<br>
                    <span class="command">print</span> - Print file<br>
                    <span class="command">download</span> - Download file<br>
                    <span class="command">view</span> - View file content<br>
                    <span class="command">exit</span> - Exit file mode<br>
                `;
                output.appendChild(headerDiv);
                
                if (!file.isDirectory) {
                    // Show loading for content
                    const loadingDiv = document.createElement('div');
                    loadingDiv.className = 'output';
                    loadingDiv.innerHTML = `<span class="loading"></span><span class="info">Loading file content...</span>`;
                    output.appendChild(loadingDiv);
                    
                    // Get file content
                    const content = await this.fileScanner.getFileContent(fileName);
                    
                    // Remove loading
                    loadingDiv.remove();
                    
                    // Show content with syntax highlighting
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'code-preview';
                    
                    const lines = content.split('\n');
                    let htmlContent = '';
                    
                    // Simple syntax highlighting
                    const isCodeFile = fileName.match(/\.(html|css|js|json|py|java|cpp|c|md|txt)$/i);
                    
                    if (isCodeFile) {
                        lines.forEach((line, index) => {
                            let lineContent = line;
                            // Basic syntax highlighting
                            if (fileName.endsWith('.html')) {
                                lineContent = lineContent
                                    .replace(/&/g, '&amp;')
                                    .replace(/</g, '&lt;')
                                    .replace(/>/g, '&gt;')
                                    .replace(/(".*?")/g, '<span style="color:#ff6b8b;">$1</span>')
                                    .replace(/&lt;\/?([a-zA-Z][a-zA-Z0-9]*)/g, '<span style="color:#4af626;">&lt;$1</span>');
                            } else if (fileName.endsWith('.js')) {
                                lineContent = lineContent
                                    .replace(/(".*?")/g, '<span style="color:#ff6b8b;">$1</span>')
                                    .replace(/(function|const|let|var|return|if|else|for|while)/g, '<span style="color:#4af626;">$1</span>');
                            } else if (fileName.endsWith('.css')) {
                                lineContent = lineContent
                                    .replace(/([\.#]?[a-zA-Z][a-zA-Z0-9]*)\s*\{/g, '<span style="color:#4af626;">$1</span> {')
                                    .replace(/:\s*(.*?);/g, ': <span style="color:#ffaa00;">$1</span>;');
                            }
                            
                            htmlContent += `<div><span class="line-number">${(index + 1).toString().padStart(3, ' ')}</span> ${lineContent}</div>`;
                        });
                    } else {
                        // Plain text display
                        htmlContent = `<pre>${content.substring(0, 2000)}${content.length > 2000 ? '\n\n... (content truncated)' : ''}</pre>`;
                    }
                    
                    contentDiv.innerHTML = htmlContent;
                    output.appendChild(contentDiv);
                    
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'output';
                    infoDiv.innerHTML = `<span class="info">File size: ${content.length} characters, ${lines.length} lines</span>`;
                    output.appendChild(infoDiv);
                } else if (file.isDirectory) {
                    const dirDiv = document.createElement('div');
                    dirDiv.className = 'output warning';
                    dirDiv.textContent = 'This is a directory. Use "ls" to view its contents.';
                    output.appendChild(dirDiv);
                }
                
                createInputLine();
            }
            
            async executeFileCommand(command) {
                const output = document.getElementById('terminal-output');
                const resultDiv = document.createElement('div');
                resultDiv.className = 'output';
                
                switch(command) {
                    case 'open':
                        resultDiv.innerHTML = `<span class="system">Opening ${this.currentFile} in new tab...</span>`;
                        output.appendChild(resultDiv);
                        
                        // Get file content and open in new tab
                        const content = await this.fileScanner.getFileContent(this.currentFile);
                        const blob = new Blob([content], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        window.open(url, '_blank');
                        
                        setTimeout(() => {
                            URL.revokeObjectURL(url);
                        }, 1000);
                        break;
                        
                    case 'print':
                        resultDiv.innerHTML = `<span class="system">Opening print dialog for ${this.currentFile}...</span>`;
                        output.appendChild(resultDiv);
                        setTimeout(() => {
                            window.print();
                        }, 500);
                        break;
                        
                    case 'download':
                        resultDiv.innerHTML = `<span class="loading"></span><span class="info">Downloading ${this.currentFile}...</span>`;
                        output.appendChild(resultDiv);
                        
                        const success = await this.fileScanner.downloadFile(this.currentFile);
                        if (success) {
                            resultDiv.innerHTML = `<span class="success">Download started: ${this.currentFile}</span>`;
                        } else {
                            resultDiv.innerHTML = `<span class="error">Failed to download ${this.currentFile}</span>`;
                        }
                        break;
                        
                    case 'view':
                        // Just show the file again
                        this.enterFileMode(this.currentFile);
                        return;
                        
                    case 'exit':
                        this.exitFileMode();
                        return;
                }
                
                if (command !== 'exit') {
                    createInputLine();
                }
            }
            
            exitFileMode() {
                this.mode = 'ora-tool';
                this.currentFile = null;
                
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                const exitDiv = document.createElement('div');
                exitDiv.className = 'output';
                exitDiv.innerHTML = `<span class="system">Exiting file...</span>`;
                output.appendChild(exitDiv);
                
                setTimeout(() => {
                    this.listFiles();
                }, 500);
            }
            
            exitORATool() {
                this.mode = 'normal';
                this.currentPath = '/';
                this.currentFile = null;
                this.loggedIn = false;
                
                const output = document.getElementById('terminal-output');
                output.innerHTML = '';
                
                const exitDiv = document.createElement('div');
                exitDiv.className = 'output';
                exitDiv.innerHTML = `
                    <span class="system">Exiting ORA Tool...</span><br>
                    <span class="success">Returning to ORA Terminal.</span><br><br>
                `;
                output.appendChild(exitDiv);
                
                setTimeout(() => {
                    output.innerHTML = '';
                    const welcomeDiv = document.createElement('div');
                    welcomeDiv.className = 'output';
                    welcomeDiv.innerHTML = `
                        <span class="system">system 0.1 is running</span><br>
                        <span class="system">> ora terminal shell</span><br>
                        <span class="system">> made by Bertrand</span><br>
                        <span class="system">> 2025</span><br><br>
                        <span class="info">Type 'help' to see functions</span><br>
                        <span class="info">Type 'orastart' to launch ORA Tool</span><br>
                        <span class="info">Type 'color 1-12' to change matrix color</span><br><br>
                    `;
                    output.appendChild(welcomeDiv);
                    createInputLine();
                }, 1500);
            }
            
            async handleORAToolCommand(cmd, args) {
                const output = document.getElementById('terminal-output');
                
                if (cmd === 'ls') {
                    await this.listFiles();
                    return true;
                } else if (cmd === 'cd') {
                    if (args.length === 0) {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'output error';
                        errorDiv.textContent = 'Usage: cd filename';
                        output.appendChild(errorDiv);
                        createInputLine();
                        return true;
                    }
                    
                    const fileName = args[0];
                    const files = await this.fileScanner.scanFiles();
                    const file = files.find(f => f.name === fileName);
                    
                    if (!file) {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'output error';
                        errorDiv.textContent = `File not found: ${fileName}`;
                        output.appendChild(errorDiv);
                        createInputLine();
                        return true;
                    }
                    
                    const msgDiv = document.createElement('div');
                    msgDiv.className = 'output';
                    msgDiv.innerHTML = `<span class="system">Opening ${file.isDirectory ? 'directory' : 'file'}: ${fileName}</span>`;
                    output.appendChild(msgDiv);
                    
                    setTimeout(() => {
                        this.enterFileMode(fileName);
                    }, 500);
                    return true;
                } else if (cmd === 'exit') {
                    this.exitORATool();
                    return true;
                } else if (['open', 'print', 'download', 'view'].includes(cmd)) {
                    if (this.mode === 'file-mode') {
                        await this.executeFileCommand(cmd);
                        return true;
                    } else {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'output error';
                        errorDiv.textContent = `You're currently inside a file. Use "exit" first.`;
                        output.appendChild(errorDiv);
                        createInputLine();
                        return true;
                    }
                }
                
                return false;
            }
        }
        
        // ==============================
        // TERMINAL SYSTEM
        // ==============================
        const terminalOutput = document.getElementById('terminal-output');
        const terminalContainer = document.querySelector('.terminal-container');
        const terminalHeader = document.getElementById('terminal-header');
        const oraTool = new ORATool();
        
        // Command definitions
        const commands = {
            help: {
                description: 'Show all available commands',
                execute: () => {
                    let helpText = '<span class="info">=== ORA TERMINAL COMMANDS ===</span><br><br>';
                    helpText += '<span class="matrix">System Commands:</span><br>';
                    for (const [cmd, info] of Object.entries(commands)) {
                        if (cmd !== 'orastart') {
                            helpText += `<span class="command">${cmd}</span> - ${info.description}<br>`;
                        }
                    }
                    helpText += '<br><span class="matrix">ORA Tool Commands:</span><br>';
                    helpText += '<span class="command">orastart</span> - Launch secure ORA Tool<br>';
                    helpText += '<span class="command">ls</span> - List files<br>';
                    helpText += '<span class="command">cd filename</span> - Open file/directory<br>';
                    helpText += '<span class="command">open/print/download/view</span> - File operations<br>';
                    helpText += '<span class="command">exit</span> - Exit ORA Tool<br>';
                    helpText += '<br><span class="matrix">Features:</span><br>';
                    helpText += '‚Ä¢ Matrix animation (color 1-12)<br>';
                    helpText += '‚Ä¢ Draggable & resizable terminal<br>';
                    helpText += '‚Ä¢ ORA Tool with authentication<br>';
                    helpText += '‚Ä¢ File operations demo<br>';
                    return helpText;
                }
            },
            clear: {
                description: 'Clear the terminal screen',
                execute: () => {
                    setTimeout(() => {
                        terminalOutput.innerHTML = '';
                        createInputLine();
                    }, 10);
                    return '';
                }
            },
            date: {
                description: 'Show current date and time',
                execute: () => {
                    return new Date().toLocaleString();
                }
            },
            echo: {
                description: 'Echo back the input text',
                execute: (args) => {
                    return args.join(' ');
                }
            },
            about: {
                description: 'Information about this terminal',
                execute: () => {
                    return `<span class="matrix">ORA Terminal Shell v0.1</span><br>
                    Advanced web-based terminal with demo file system<br>
                    Features: Matrix animation, ORA Tool, File operations<br>
                    Built by Bertrand ‚Ä¢ 2025<br><br>
                    <span class="info">Note: Running in demo mode (no real file access)</span>`;
                }
            },
            ls: {
                description: 'List directory contents',
                execute: () => {
                    if (oraTool.mode === 'normal') {
                        return `<span class="info">Type 'orastart' to access the ORA Tool file system</span><br>
                        <span class="info">The terminal will show demo files for testing</span>`;
                    }
                    return '';
                }
            },
            pwd: {
                description: 'Print working directory',
                execute: () => {
                    return oraTool.mode === 'normal' ? '/home/user' : oraTool.currentPath;
                }
            },
            color: {
                description: 'Change matrix animation color (1-12)',
                execute: (args) => {
                    if (args.length === 0) {
                        let colors = '<span class="info">Available colors (1-12):</span><br>';
                        matrixColors.forEach((color, index) => {
                            colors += `<span class="command">${index + 1}</span> - <span style="color:${color}">‚ñ†</span> ${color}<br>`;
                        });
                        return colors;
                    }
                    
                    const colorNum = parseInt(args[0]);
                    if (colorNum >= 1 && colorNum <= 12) {
                        matrixColor = matrixColors[colorNum - 1];
                        return `<span class="success">Matrix color changed to #${colorNum}</span>`;
                    } else {
                        return '<span class="error">Color must be between 1 and 12</span>';
                    }
                }
            },
            calc: {
                description: 'Simple calculator',
                execute: (args) => {
                    try {
                        const expression = args.join(' ');
                        const result = eval(expression);
                        return `${expression} = <span class="success">${result}</span>`;
                    } catch {
                        return '<span class="error">Invalid expression</span>';
                    }
                }
            },
            neofetch: {
                description: 'Display system information',
                execute: async () => {
                    const files = await oraTool.fileScanner.scanFiles();
                    return `
                    <span class="matrix">‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó</span><br>
                    <span class="matrix">‚ïë        ORA TERMINAL INFO             ‚ïë</span><br>
                    <span class="matrix">‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£</span><br>
                    <span class="system">‚ïë OS: ORA Terminal Shell v0.1          ‚ïë</span><br>
                    <span class="system">‚ïë Mode: ${oraTool.mode.toUpperCase()}                      ‚ïë</span><br>
                    <span class="system">‚ïë Files: ${files.length} demo files            ‚ïë</span><br>
                    <span class="system">‚ïë Matrix: ${matrixColor}              ‚ïë</span><br>
                    <span class="system">‚ïë Status: DEMO MODE                   ‚ïë</span><br>
                    <span class="matrix">‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</span>`;
                }
            },
            reboot: {
                description: 'Reboot terminal interface',
                execute: () => {
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                    return '<span class="warning">Rebooting terminal...</span>';
                }
            },
            orastart: {
                description: 'Launch secure ORA Tool with demo files',
                execute: async () => {
                    if (oraTool.mode === 'normal') {
                        await oraTool.startBootSequence();
                        return '';
                    } else if (oraTool.mode === 'boot') {
                        return '<span class="info">Boot sequence already running...</span>';
                    } else {
                        return '<span class="error">Already in ORA Tool mode. Type "exit" first.</span>';
                    }
                }
            }
        };
        
        // Command history
        let commandHistory = [];
        let historyIndex = 0;
        
        // ==============================
        // INPUT HANDLING
        // ==============================
        function createInputLine() {
            const inputLine = document.createElement('div');
            inputLine.className = 'input-line';
            
            let promptText = '$';
            if (oraTool.mode === 'ora-tool') {
                promptText = `ORA:${oraTool.currentPath}$`;
            } else if (oraTool.mode === 'file-mode') {
                promptText = `file:${oraTool.currentFile}$`;
            } else if (oraTool.mode === 'login' || oraTool.mode === 'boot') {
                promptText = '>';
            }
            
            inputLine.innerHTML = `
                <span class="prompt">${promptText}</span>
                <input type="text" class="command-input" autocomplete="off">
                <span class="cursor"></span>
            `;
            terminalOutput.appendChild(inputLine);
            
            const input = inputLine.querySelector('.command-input');
            
            // Focus after a short delay
            setTimeout(() => {
                input.focus();
            }, 10);
            
            // Handle key events
            input.addEventListener('keydown', async (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const command = input.value.trim();
                    inputLine.remove();
                    await processCommand(command);
                }
                
                // Tab completion
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const currentInput = input.value.trim();
                    const matchingCommands = Object.keys(commands).filter(cmd => 
                        cmd.startsWith(currentInput)
                    );
                    if (matchingCommands.length === 1) {
                        input.value = matchingCommands[0] + ' ';
                    }
                }
                
                // Command history
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (commandHistory.length > 0 && historyIndex > 0) {
                        historyIndex--;
                        input.value = commandHistory[historyIndex] || '';
                    }
                }
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (commandHistory.length > 0 && historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        input.value = commandHistory[historyIndex] || '';
                    } else {
                        historyIndex = commandHistory.length;
                        input.value = '';
                    }
                }
            });
            
            // Auto-scroll
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }
        
        async function processCommand(fullCommand) {
            // Add to history
            commandHistory.push(fullCommand);
            historyIndex = commandHistory.length;
            
            // Display command
            const commandOutput = document.createElement('div');
            commandOutput.className = 'output';
            
            let promptText = '$';
            if (oraTool.mode === 'ora-tool') {
                promptText = `ORA:${oraTool.currentPath}$`;
            } else if (oraTool.mode === 'file-mode') {
                promptText = `file:${oraTool.currentFile}$`;
            } else if (oraTool.mode === 'login' || oraTool.mode === 'boot') {
                promptText = '>';
            }
            
            commandOutput.innerHTML = `<span class="prompt">${promptText}</span> <span class="command">${fullCommand}</span>`;
            terminalOutput.appendChild(commandOutput);
            
            // Parse command
            const [cmd, ...args] = fullCommand.split(' ');
            
            const resultDiv = document.createElement('div');
            resultDiv.className = 'output';
            
            if (cmd === '') {
                resultDiv.innerHTML = '';
            } else {
                // Check if in ORA Tool mode
                if (oraTool.mode === 'ora-tool' || oraTool.mode === 'file-mode') {
                    const handled = await oraTool.handleORAToolCommand(cmd, args);
                    if (handled) {
                        return;
                    }
                }
                
                // Check if in login mode
                if (oraTool.mode === 'login' || oraTool.mode === 'boot') {
                    resultDiv.innerHTML = '<span class="error">Please complete authentication first</span>';
                } else if (commands[cmd]) {
                    try {
                        const result = commands[cmd].execute(args);
                        if (result instanceof Promise) {
                            resultDiv.innerHTML = await result;
                        } else {
                            resultDiv.innerHTML = result;
                        }
                    } catch (error) {
                        resultDiv.innerHTML = `<span class="error">Error: ${error.message}</span>`;
                    }
                } else {
                    resultDiv.innerHTML = `<span class="error">Command not found: ${cmd}</span><br>
                    Type <span class="command">'help'</span> for available commands`;
                }
            }
            
            terminalOutput.appendChild(resultDiv);
            createInputLine();
        }
        
        // ==============================
        // CONTROL PANEL FUNCTIONS
        // ==============================
        const hidePanelBtn = document.getElementById('hide-panel');
        const resetBtn = document.getElementById('reset-terminal');
        const controlPanel = document.querySelector('.control-panel');
        
        // Hide/show panel
        hidePanelBtn.addEventListener('click', () => {
            if (controlPanel.style.display !== 'none') {
                controlPanel.style.display = 'none';
                hidePanelBtn.textContent = 'Show Panel';
            } else {
                controlPanel.style.display = 'block';
                hidePanelBtn.textContent = 'Hide Panel';
            }
        });
        
        // Reset terminal position
        resetBtn.addEventListener('click', () => {
            terminalContainer.style.left = '50%';
            terminalContainer.style.top = '50%';
            terminalContainer.style.transform = 'translate(-50%, -50%)';
            terminalContainer.style.width = '800px';
            terminalContainer.style.height = '500px';
            terminalContainer.classList.add('terminal-start-animation');
            
            setTimeout(() => {
                terminalContainer.classList.remove('terminal-start-animation');
            }, 500);
        });
        
        // Window buttons
        document.getElementById('close-btn').addEventListener('click', () => {
            terminalContainer.style.display = 'none';
            const message = document.createElement('div');
            message.className = 'output error';
            message.textContent = 'Terminal closed. Refresh page to restart.';
            terminalOutput.appendChild(message);
        });
        
        document.getElementById('minimize-btn').addEventListener('click', () => {
            terminalContainer.style.height = '45px';
            setTimeout(() => {
                terminalContainer.style.height = '500px';
            }, 2000);
        });
        
        document.getElementById('maximize-btn').addEventListener('click', () => {
            if (terminalContainer.style.width === '95vw') {
                resetBtn.click();
            } else {
                terminalContainer.style.width = '95vw';
                terminalContainer.style.height = '90vh';
                terminalContainer.style.left = '2.5vw';
                terminalContainer.style.top = '5vh';
                terminalContainer.style.transform = 'none';
            }
        });
        
        // ==============================
        // INITIALIZATION
        // ==============================
        async function init() {
            // Initialize matrix
            initMatrix();
            let matrixInterval = setInterval(drawMatrix, 50);
            
            // Initialize terminal
            createInputLine();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                initMatrix();
                // Keep terminal within bounds
                const rect = terminalContainer.getBoundingClientRect();
                if (rect.right > window.innerWidth || rect.bottom > window.innerHeight) {
                    resetBtn.click();
                }
            });
            
            // Global click to focus input
            document.addEventListener('click', (e) => {
                // Don't refocus if clicking on control panel or terminal header
                if (!controlPanel.contains(e.target) && !terminalHeader.contains(e.target)) {
                    const input = document.querySelector('.command-input');
                    if (input) input.focus();
                }
            });
        }
        
        // Start everything
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
